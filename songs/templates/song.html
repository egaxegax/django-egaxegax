{% extends 'base.html' %}
{% load i18n %}
{% load markup %}
{% load myfilter %}
{% block description %}{{ song.desc|strip_text }} {% endblock %}
{% block keywords %}{{ song.artist }}, {{ song.title }}, {% trans 'chords' %}, {% endblock %}
{% block title %}{{ song.artist }} - {{ song.title }}, {% trans 'chords' %} - {% endblock %}
{% block pagestyle %}
#id_search { height: 16px; margin-left: 10px; }
.msgcont { line-height: 1.5em; }
.msgcont b { font-weight: 500; color: #5645ad; }
{% endblock %}
{% block songsclass %}wrap{% endblock %}
{% block pagescript %}
<!--google+ comments-->
<script src="https://apis.google.com/js/plusone.js"></script>
<!--/google+ comments-->
{% endblock %}
{% block pageheader %}
{% endblock %}

{% block content %}

<div class="indexlist wrap">
  <a class="hspaced" href="{% url 'songs.views.list_art' %}">{% trans 'Full list' %}</a>
  {% for i, v in art_index.items %}
    <a class="nodecor hspaced" href="{% url 'songs.views.list_art' ind_art=i %}">{{ v|capfirst }}</a>
  {% endfor %}
  <form class="search" action="{% url 'songs.views.list_songs' %}" method="get">{% csrf_token %}
    {{ form }}
    <input class="submit" type="submit" value="{% trans 'Search' %}" />
  </form>
</div>

<p>
  <h2 class="nomarg"><a class="nodecor" href="{% url 'songs.views.list_songs' id_art=song.art_id %}"><span class="hspace">{{ song.artist }} </span></a>{{ song.title }}</h2>
</p>

{% for song in songs %}

  {% if not song.date and song.content %}
    <div class="wrap">
      <div class="msgtext smaller">
        {{ song.content|markdown:"codehilite,extra" }}
      </div>
      <div class="msgfooter gray">
        {% if request.user.is_authenticated and request.user.id == song.author.id or request.user.is_superuser %}
          <a class="nodecor" href="{% url 'songs.views.edit_song' id=song.id %}">{% trans 'Edit' %}</a>
          <a class="nodecor" href="{% url 'songs.views.delete_song' id=song.id %}">{% trans 'Delete' %}</a>
        {% endif %}
      </div>
    </div>
  {% else %}
    {% if song.audio %}
      <p>
        <table>
        <tr><td align="center" valign="center"> {% trans 'Listen' %}: &nbsp; </td>
          <td> <audio src="{% url 'songs.views.get_song_file' id=song.id %}" controls></audio> </td></tr>
        </table>
      </p>
    {% endif %}
    <div class="wrap">
      <div class="msgtext msgcont">{{ song.content|safe }}</div>
      <div class="msgfooter gray">
        {% if song.author %}
          <a class="nodecor" href="{% url 'songs.views.get_user_profile' id=song.author.id %}">{{ song.author.username }}</a> {% trans 'wrote' %}
        {% else %}
          {% trans 'An anonymous person' %} {% trans 'wrote' %}
        {% endif %}
        {% if song.date %}
          <acronym title="{{ song.date }}">{{ song.date|time_since }}</acronym> {% trans 'ago' %}
        {% endif %}
        {% if request.user.is_authenticated and request.user.id == song.author.id or request.user.is_superuser %}
          <a class="nodecor" href="{% url 'songs.views.edit_song' id=song.id %}">{% trans 'Edit' %}</a>
          <a class="nodecor" href="{% url 'songs.views.delete_song' id=song.id %}">{% trans 'Delete' %}</a>
        {% endif %}
      </div>
    </div>
  {% endif %}

{% endfor %}

{% if request.user.is_authenticated %}
  <p class="smaller hspace"><a href="{% url 'songs.views.add_song' %}">{% trans 'Add song' %}</a></p>
{% else %}
  <p class="smaller hspace">{% trans 'Please authorize to add songs' %}.</p>
{% endif %}

<!--google+ comments-->
<div id="comments"></div>
<script>
gapi.comments.render('comments', {
    href: window.location,
    width: '640',
    first_party_property: 'BLOGGER',
    view_type: 'FILTERED_POSTMOD'
});
</script>
<!--/google+ comments-->

{% endblock %}
